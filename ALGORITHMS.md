# üßÆ –ê–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞—Å—á–µ—Ç–æ–≤

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –¥–ª—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞.

---

## 1. –†–∞—Å—á–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –¥–≤–∏–∂–µ–Ω–∏—è

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ü–µ–ª–µ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `gradient` - —É–∫–ª–æ–Ω –¥–æ—Ä–æ–≥–∏ (%)
- `maxSpeed` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –¢–° (–∫–º/—á)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `targetSpeed` - —Ü–µ–ª–µ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)

**–ö–æ–¥:**
```javascript
function calculateTargetSpeed(gradient, maxSpeed) {
    let targetSpeed;
    
    if (gradient > 5) {
        // –ö—Ä—É—Ç–æ–π –ø–æ–¥—ä–µ–º: —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 5 –∫–º/—á –∑–∞ –∫–∞–∂–¥—ã–π % —Å–≤–µ—Ä—Ö 5%
        targetSpeed = Math.max(30, maxSpeed - (gradient - 5) * 5);
    } else if (gradient < -5) {
        // –ö—Ä—É—Ç–æ–π —Å–ø—É—Å–∫: —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 3 –∫–º/—á –∑–∞ –∫–∞–∂–¥—ã–π % —Å–≤–µ—Ä—Ö 5%
        targetSpeed = Math.max(40, maxSpeed - Math.abs(gradient + 5) * 3);
    } else if (gradient > 2) {
        // –ü–æ–¥—ä–µ–º: 80% –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π
        targetSpeed = maxSpeed * 0.8;
    } else if (gradient < -2) {
        // –°–ø—É—Å–∫: 85% –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π
        targetSpeed = maxSpeed * 0.85;
    } else {
        // –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è: 70% –æ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π
        targetSpeed = maxSpeed * 0.7;
    }
    
    return targetSpeed;
}
```

**–ü—Ä–∏–º–µ—Ä—ã:**

| –£–∫–ª–æ–Ω | –ú–∞–∫—Å. —Å–∫–æ—Ä–æ—Å—Ç—å | –¶–µ–ª–µ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å | –ü—Ä–∏—á–∏–Ω–∞ |
|-------|---------------|------------------|---------|
| 0% | 90 –∫–º/—á | 63 –∫–º/—á | –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (70%) |
| 3% | 90 –∫–º/—á | 72 –∫–º/—á | –ü–æ–¥—ä–µ–º (80%) |
| 8% | 90 –∫–º/—á | 75 –∫–º/—á | –ö—Ä—É—Ç–æ–π –ø–æ–¥—ä–µ–º (90 - (8-5)√ó5) |
| -3% | 90 –∫–º/—á | 77 –∫–º/—á | –°–ø—É—Å–∫ (85%) |
| -8% | 90 –∫–º/—á | 81 –∫–º/—á | –ö—Ä—É—Ç–æ–π —Å–ø—É—Å–∫ (90 - (8-5)√ó3) |

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ù–∞ –ø–æ–¥—ä–µ–º–µ –¥–≤–∏–≥–∞—Ç–µ–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π ‚Üí —Å–Ω–∏–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
- –ù–∞ —Å–ø—É—Å–∫–µ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –ø–æ–º–æ–≥–∞–µ—Ç ‚Üí –º–æ–∂–Ω–æ –µ—Ö–∞—Ç—å –±—ã—Å—Ç—Ä–µ–µ
- –ö—Ä—É—Ç—ã–µ —É—á–∞—Å—Ç–∫–∏ —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ–≥–æ —Å–Ω–∏–∂–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å 30 –∫–º/—á (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

---

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–ª–∞–≤–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `currentSpeed` - —Ç–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)
- `targetSpeed` - —Ü–µ–ª–µ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)
- `acceleration` - —É—Å–∫–æ—Ä–µ–Ω–∏–µ (–∫–º/—á –∑–∞ —Å–µ–∫—É–Ω–¥—É)
- `deceleration` - —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ (–∫–º/—á –∑–∞ —Å–µ–∫—É–Ω–¥—É)
- `dt` - –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∞–≥ (—Å–µ–∫—É–Ω–¥—ã)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `newSpeed` - –Ω–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)

**–ö–æ–¥:**
```javascript
function updateSpeed(currentSpeed, targetSpeed, acceleration, deceleration, dt) {
    if (currentSpeed < targetSpeed) {
        // –£—Å–∫–æ—Ä–µ–Ω–∏–µ
        return Math.min(targetSpeed, currentSpeed + acceleration * dt);
    } else if (currentSpeed > targetSpeed) {
        // –¢–æ—Ä–º–æ–∂–µ–Ω–∏–µ
        return Math.max(targetSpeed, currentSpeed - deceleration * dt);
    } else {
        // –£–∂–µ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏
        return currentSpeed;
    }
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- `acceleration = 5.0` –∫–º/—á/—Å (—É–º–µ—Ä–µ–Ω–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ)
- `deceleration = 8.0` –∫–º/—á/—Å (–±–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ)
- `dt = 0.1` —Å (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 100–º—Å)

**–ü—Ä–∏–º–µ—Ä:**

```
–ù–∞—á–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: 40 –∫–º/—á
–¶–µ–ª–µ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: 60 –∫–º/—á
–£—Å–∫–æ—Ä–µ–Ω–∏–µ: 5 –∫–º/—á/—Å

–ò—Ç–µ—Ä–∞—Ü–∏—è 1 (0.1—Å): 40 + 5√ó0.1 = 40.5 –∫–º/—á
–ò—Ç–µ—Ä–∞—Ü–∏—è 2 (0.2—Å): 40.5 + 5√ó0.1 = 41.0 –∫–º/—á
...
–ò—Ç–µ—Ä–∞—Ü–∏—è 40 (4.0—Å): 60 –∫–º/—á (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ —Ü–µ–ª–µ–≤–∞—è)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ (–Ω–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- –¢–æ—Ä–º–æ–∂–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–µ–µ —É—Å–∫–æ—Ä–µ–Ω–∏—è (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- –ü–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è

---

## 2. –†–∞—Å—á–µ—Ç —Ä–∞—Å—Ö–æ–¥–∞ —Ç–æ–ø–ª–∏–≤–∞

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞—Å—á–µ—Ç–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—Å—Ö–æ–¥–∞

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `speed` - —Ç–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)
- `gradient` - —É–∫–ª–æ–Ω –¥–æ—Ä–æ–≥–∏ (%)
- `baseConsumption` - –±–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥ (–ª/100–∫–º)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `consumption` - —Ç–µ–∫—É—â–∏–π —Ä–∞—Å—Ö–æ–¥ (–ª/100–∫–º)

**–§–æ—Ä–º—É–ª–∞:**
```
–†–∞—Å—Ö–æ–¥ = –ë–∞–∑–æ–≤—ã–π–†–∞—Å—Ö–æ–¥ √ó –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–°–∫–æ—Ä–æ—Å—Ç–∏ √ó –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–£–∫–ª–æ–Ω–∞

–≥–¥–µ:
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–°–∫–æ—Ä–æ—Å—Ç–∏ = 1 + (–°–∫–æ—Ä–æ—Å—Ç—å - 60) √ó 0.01
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–£–∫–ª–æ–Ω–∞ = 1 + –£–∫–ª–æ–Ω √ó 0.05
```

**–ö–æ–¥:**
```javascript
function calculateCurrentConsumption(speed, gradient, baseConsumption) {
    if (speed === 0) return 0;
    
    // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ (–æ–ø—Ç–∏–º—É–º –Ω–∞ 60 –∫–º/—á)
    const speedFactor = 1 + (speed - 60) * 0.01;
    
    // –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —É–∫–ª–æ–Ω–∞ (5% –Ω–∞ –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç —É–∫–ª–æ–Ω–∞)
    const gradientFactor = 1 + gradient * 0.05;
    
    // –ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥
    const consumption = baseConsumption * speedFactor * gradientFactor;
    
    return Math.max(0, consumption);
}
```

**–ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—á–µ—Ç–∞:**

**–ü—Ä–∏–º–µ—Ä 1: –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è**
```
–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥: 12 –ª/100–∫–º
–°–∫–æ—Ä–æ—Å—Ç—å: 60 –∫–º/—á
–£–∫–ª–æ–Ω: 0%

–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–°–∫–æ—Ä–æ—Å—Ç–∏ = 1 + (60-60)√ó0.01 = 1.0
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–£–∫–ª–æ–Ω–∞ = 1 + 0√ó0.05 = 1.0
–†–∞—Å—Ö–æ–¥ = 12 √ó 1.0 √ó 1.0 = 12.0 –ª/100–∫–º
```

**–ü—Ä–∏–º–µ—Ä 2: –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å**
```
–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥: 12 –ª/100–∫–º
–°–∫–æ—Ä–æ—Å—Ç—å: 80 –∫–º/—á
–£–∫–ª–æ–Ω: 0%

–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–°–∫–æ—Ä–æ—Å—Ç–∏ = 1 + (80-60)√ó0.01 = 1.2
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–£–∫–ª–æ–Ω–∞ = 1 + 0√ó0.05 = 1.0
–†–∞—Å—Ö–æ–¥ = 12 √ó 1.2 √ó 1.0 = 14.4 –ª/100–∫–º (+20%)
```

**–ü—Ä–∏–º–µ—Ä 3: –ü–æ–¥—ä–µ–º**
```
–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥: 12 –ª/100–∫–º
–°–∫–æ—Ä–æ—Å—Ç—å: 60 –∫–º/—á
–£–∫–ª–æ–Ω: 5%

–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–°–∫–æ—Ä–æ—Å—Ç–∏ = 1 + (60-60)√ó0.01 = 1.0
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–£–∫–ª–æ–Ω–∞ = 1 + 5√ó0.05 = 1.25
–†–∞—Å—Ö–æ–¥ = 12 √ó 1.0 √ó 1.25 = 15.0 –ª/100–∫–º (+25%)
```

**–ü—Ä–∏–º–µ—Ä 4: –í—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å + –ø–æ–¥—ä–µ–º**
```
–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥: 12 –ª/100–∫–º
–°–∫–æ—Ä–æ—Å—Ç—å: 80 –∫–º/—á
–£–∫–ª–æ–Ω: 5%

–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–°–∫–æ—Ä–æ—Å—Ç–∏ = 1 + (80-60)√ó0.01 = 1.2
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–£–∫–ª–æ–Ω–∞ = 1 + 5√ó0.05 = 1.25
–†–∞—Å—Ö–æ–¥ = 12 √ó 1.2 √ó 1.25 = 18.0 –ª/100–∫–º (+50%)
```

**–ü—Ä–∏–º–µ—Ä 5: –°–ø—É—Å–∫**
```
–ë–∞–∑–æ–≤—ã–π —Ä–∞—Å—Ö–æ–¥: 12 –ª/100–∫–º
–°–∫–æ—Ä–æ—Å—Ç—å: 60 –∫–º/—á
–£–∫–ª–æ–Ω: -3%

–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–°–∫–æ—Ä–æ—Å—Ç–∏ = 1 + (60-60)√ó0.01 = 1.0
–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–£–∫–ª–æ–Ω–∞ = 1 + (-3)√ó0.05 = 0.85
–†–∞—Å—Ö–æ–¥ = 12 √ó 1.0 √ó 0.85 = 10.2 –ª/100–∫–º (-15%)
```

**–¢–∞–±–ª–∏—Ü–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

| –°–∫–æ—Ä–æ—Å—Ç—å | –£–∫–ª–æ–Ω | –ö–æ—ç—Ñ. —Å–∫–æ—Ä–æ—Å—Ç–∏ | –ö–æ—ç—Ñ. —É–∫–ª–æ–Ω–∞ | –†–∞—Å—Ö–æ–¥ |
|----------|-------|----------------|--------------|--------|
| 40 –∫–º/—á | 0% | 0.80 | 1.00 | 9.6 –ª/100–∫–º |
| 60 –∫–º/—á | 0% | 1.00 | 1.00 | 12.0 –ª/100–∫–º |
| 80 –∫–º/—á | 0% | 1.20 | 1.00 | 14.4 –ª/100–∫–º |
| 60 –∫–º/—á | 3% | 1.00 | 1.15 | 13.8 –ª/100–∫–º |
| 60 –∫–º/—á | 5% | 1.00 | 1.25 | 15.0 –ª/100–∫–º |
| 60 –∫–º/—á | -3% | 1.00 | 0.85 | 10.2 –ª/100–∫–º |
| 80 –∫–º/—á | 5% | 1.20 | 1.25 | 18.0 –ª/100–∫–º |

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å 60 –∫–º/—á (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥)
- –í—ã—à–µ/–Ω–∏–∂–µ 60 –∫–º/—á ‚Üí —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞
- –ü–æ–¥—ä–µ–º —Ç—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ —Ç–æ–ø–ª–∏–≤–∞ (—Ä–∞–±–æ—Ç–∞ –ø—Ä–æ—Ç–∏–≤ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏)
- –°–ø—É—Å–∫ —ç–∫–æ–Ω–æ–º–∏—Ç —Ç–æ–ø–ª–∏–≤–æ (–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è –ø–æ–º–æ–≥–∞–µ—Ç)
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## 3. –†–∞—Å—á–µ—Ç —É–∫–ª–æ–Ω–∞ –¥–æ—Ä–æ–≥–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `elevation[i-1]` - –≤—ã—Å–æ—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ç–æ—á–∫–∏ (–º)
- `elevation[i]` - –≤—ã—Å–æ—Ç–∞ —Ç–µ–∫—É—â–µ–π —Ç–æ—á–∫–∏ (–º)
- `distance[i-1]` - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ç–æ—á–∫–∏ (–º)
- `distance[i]` - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ç–µ–∫—É—â–µ–π —Ç–æ—á–∫–∏ (–º)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `gradient` - —É–∫–ª–æ–Ω (%)

**–§–æ—Ä–º—É–ª–∞:**
```
–ì—Ä–∞–¥–∏–µ–Ω—Ç = (Œî–í—ã—Å–æ—Ç–∞ / Œî–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ) √ó 100%

–≥–¥–µ:
Œî–í—ã—Å–æ—Ç–∞ = elevation[i] - elevation[i-1]
Œî–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ = distance[i] - distance[i-1]
```

**–ö–æ–¥:**
```python
def compute_gradients(elevations, distances):
    n = len(elevations)
    gradients = [None] * n
    gradients[0] = 0.0  # –ü–µ—Ä–≤–∞—è —Ç–æ—á–∫–∞
    
    for i in range(1, n):
        e0 = elevations[i-1]
        e1 = elevations[i]
        
        if e0 is None or e1 is None:
            gradients[i] = None
            continue
        
        dx = distances[i] - distances[i-1]
        
        if dx == 0:
            gradients[i] = 0.0
        else:
            # –ì—Ä–∞–¥–∏–µ–Ω—Ç –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
            gradients[i] = (e1 - e0) / dx * 100.0
    
    return gradients
```

**–ü—Ä–∏–º–µ—Ä—ã:**

**–ü—Ä–∏–º–µ—Ä 1: –ü–æ–¥—ä–µ–º**
```
–¢–æ—á–∫–∞ A: –≤—ã—Å–æ—Ç–∞ 100–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 0–º
–¢–æ—á–∫–∞ B: –≤—ã—Å–æ—Ç–∞ 105–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 100–º

Œî–í—ã—Å–æ—Ç–∞ = 105 - 100 = 5–º
Œî–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ = 100 - 0 = 100–º
–ì—Ä–∞–¥–∏–µ–Ω—Ç = (5 / 100) √ó 100% = 5%
```

**–ü—Ä–∏–º–µ—Ä 2: –°–ø—É—Å–∫**
```
–¢–æ—á–∫–∞ A: –≤—ã—Å–æ—Ç–∞ 150–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 0–º
–¢–æ—á–∫–∞ B: –≤—ã—Å–æ—Ç–∞ 145–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 100–º

Œî–í—ã—Å–æ—Ç–∞ = 145 - 150 = -5–º
Œî–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ = 100 - 0 = 100–º
–ì—Ä–∞–¥–∏–µ–Ω—Ç = (-5 / 100) √ó 100% = -5%
```

**–ü—Ä–∏–º–µ—Ä 3: –†–æ–≤–Ω–∞—è –¥–æ—Ä–æ–≥–∞**
```
–¢–æ—á–∫–∞ A: –≤—ã—Å–æ—Ç–∞ 100–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 0–º
–¢–æ—á–∫–∞ B: –≤—ã—Å–æ—Ç–∞ 100–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ 100–º

Œî–í—ã—Å–æ—Ç–∞ = 100 - 100 = 0–º
Œî–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ = 100 - 0 = 100–º
–ì—Ä–∞–¥–∏–µ–Ω—Ç = (0 / 100) √ó 100% = 0%
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- `gradient > 0` - –ø–æ–¥—ä–µ–º
- `gradient < 0` - —Å–ø—É—Å–∫
- `gradient = 0` - —Ä–æ–≤–Ω–∞—è –¥–æ—Ä–æ–≥–∞
- `|gradient| > 5%` - –∫—Ä—É—Ç–æ–π —É—á–∞—Å—Ç–æ–∫
- `|gradient| > 10%` - –æ—á–µ–Ω—å –∫—Ä—É—Ç–æ–π —É—á–∞—Å—Ç–æ–∫

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–æ—Å—Ç–∞—è –∏ —Ç–æ—á–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞
- –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ –¥–æ—Ä–æ–≥–µ
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ (None)

---

## 4. –†–∞—Å—á–µ—Ç –≤—ã—Å–æ—Ç –∏–∑ DEM

### –ê–ª–≥–æ—Ä–∏—Ç–º sampling –≤—ã—Å–æ—Ç

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `dem_path` - –ø—É—Ç—å –∫ GeoTIFF —Ñ–∞–π–ª—É
- `latlon_array` - –º–∞—Å—Å–∏–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç [(lat, lon), ...]
- `batch` - —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50,000)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `elevations` - –º–∞—Å—Å–∏–≤ –≤—ã—Å–æ—Ç [h1, h2, ..., hn]

**–ö–æ–¥:**
```python
def sample_elevations_rasterio(dem_path, latlon_array, batch=50000):
    n = latlon_array.shape[0]
    elevs = [None] * n
    
    # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ —Ñ–æ—Ä–º–∞—Ç (lon, lat) –¥–ª—è rasterio
    coords = [(float(lon), float(lat)) for lat, lon in latlon_array]
    
    with rasterio.open(dem_path) as ds:
        nodata = ds.nodatavals[0]
        
        idx = 0
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–∞—Ç—á–∞–º–∏
        for i in range(0, n, batch):
            chunk = coords[i:i+batch]
            
            # –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—ã
            for v in ds.sample(chunk):
                val = None
                try:
                    val = float(v[0])
                    if nodata is not None and val == nodata:
                        val = None
                except Exception:
                    val = None
                
                elevs[idx] = val
                idx += 1
    
    return elevs
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–û—Ç–∫—Ä—ã—Ç–∏–µ GeoTIFF:**
```python
with rasterio.open(dem_path) as ds:
    # ds - dataset —Å –≤—ã—Å–æ—Ç–∞–º–∏
    # ds.bounds - –≥—Ä–∞–Ω–∏—Ü—ã –ø–æ–∫—Ä—ã—Ç–∏—è
    # ds.nodatavals - –∑–Ω–∞—á–µ–Ω–∏—è "–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö"
```

2. **–ë–∞—Ç—á–∏–Ω–≥:**
```python
# –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ –±–∞—Ç—á–∏ –ø–æ 50,000 —Ç–æ—á–µ–∫
for i in range(0, 100000, 50000):
    chunk = coords[i:i+50000]  # 50,000 —Ç–æ—á–µ–∫
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–∞—Ç—á
```

3. **Sampling:**
```python
for v in ds.sample(chunk):
    # v[0] - –≤—ã—Å–æ—Ç–∞ –≤ –º–µ—Ç—Ä–∞—Ö
    # –ú–æ–∂–µ—Ç –±—ã—Ç—å nodata (-32768 –∏–ª–∏ -9999)
```

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ nodata:**
```python
if nodata is not None and val == nodata:
    val = None  # –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç—Ç–æ–π —Ç–æ—á–∫–∏
```

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

| –¢–æ—á–µ–∫ | –ë–∞—Ç—á | –í—Ä–µ–º—è |
|-------|------|-------|
| 10,000 | 50,000 | ~20 —Å–µ–∫ |
| 100,000 | 50,000 | ~3 –º–∏–Ω |
| 100,000 | 10,000 | ~4 –º–∏–Ω |
| 100,000 | 100,000 | ~2.5 –º–∏–Ω |

**–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞—Ç—á:** 50,000 —Ç–æ—á–µ–∫

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –ë–∞—Ç—á–∏–Ω–≥ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø–∞–º—è—Ç—å
- rasterio —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–∞—Ç—á–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ nodata –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏

---

## 5. –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è —Ç–æ—á–µ–∫ (Densify)

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `coords` - –º–∞—Å—Å–∏–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –æ—Ç OSRM [(lat, lon), ...] (~3000 —Ç–æ—á–µ–∫)
- `n_points` - –∂–µ–ª–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ (100,000)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `points` - –º–∞—Å—Å–∏–≤ –∏–Ω—Ç–µ—Ä–ø–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ [(lat, lon), ...] (100,000 —Ç–æ—á–µ–∫)
- `total_length` - –æ–±—â–∞—è –¥–ª–∏–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–∞ (–º)

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

**–®–∞–≥ 1: –†–∞—Å—á–µ—Ç –¥–ª–∏–Ω —Å–µ–≥–º–µ–Ω—Ç–æ–≤**
```python
seg_lengths = []
for i in range(len(coords)-1):
    dist = haversine_m(coords[i], coords[i+1])
    seg_lengths.append(dist)
```

**–®–∞–≥ 2: –ù–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ**
```python
cum = [0]
for length in seg_lengths:
    cum.append(cum[-1] + length)

total_length = cum[-1]
```

**–®–∞–≥ 3: –¶–µ–ª–µ–≤—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è**
```python
targets = np.linspace(0, total_length, n_points)
# [0, 1.85, 3.70, 5.56, ..., total_length]
```

**–®–∞–≥ 4: –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è**
```python
for target_dist in targets:
    # –ù–∞—Ö–æ–¥–∏–º —Å–µ–≥–º–µ–Ω—Ç
    seg_i = find_segment(cum, target_dist)
    
    # –î–æ–ª—è –≤–Ω—É—Ç—Ä–∏ —Å–µ–≥–º–µ–Ω—Ç–∞
    frac = (target_dist - cum[seg_i]) / seg_lengths[seg_i]
    
    # –õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è
    lat = coords[seg_i].lat + (coords[seg_i+1].lat - coords[seg_i].lat) * frac
    lon = coords[seg_i].lon + (coords[seg_i+1].lon - coords[seg_i].lon) * frac
    
    points.append((lat, lon))
```

**–ü—Ä–∏–º–µ—Ä:**

```
OSRM –≤–µ—Ä–Ω—É–ª 3 —Ç–æ—á–∫–∏:
A (0–º): lat=55.7558, lon=37.6173
B (100–º): lat=55.7568, lon=37.6183
C (200–º): lat=55.7578, lon=37.6193

–ù—É–∂–Ω–æ 5 —Ç–æ—á–µ–∫:

–¶–µ–ª–µ–≤—ã–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è: [0, 50, 100, 150, 200]

–¢–æ—á–∫–∞ 1 (0–º): A
–¢–æ—á–∫–∞ 2 (50–º): –º–µ–∂–¥—É A –∏ B, frac=0.5
    lat = 55.7558 + (55.7568-55.7558)√ó0.5 = 55.7563
    lon = 37.6173 + (37.6183-37.6173)√ó0.5 = 37.6178
–¢–æ—á–∫–∞ 3 (100–º): B
–¢–æ—á–∫–∞ 4 (150–º): –º–µ–∂–¥—É B –∏ C, frac=0.5
    lat = 55.7568 + (55.7578-55.7568)√ó0.5 = 55.7573
    lon = 37.6183 + (37.6193-37.6183)√ó0.5 = 37.6188
–¢–æ—á–∫–∞ 5 (200–º): C
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é
- –¢–æ—á–∫–∏ —Å–ª–µ–¥—É—é—Ç –¥–æ—Ä–æ–≥–∞–º (–º–µ–∂–¥—É –≤–µ—Ä—à–∏–Ω–∞–º–∏ OSRM)
- –õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–Ω–∞ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤

---

## 6. –§–æ—Ä–º—É–ª–∞ –ì–∞–≤–µ—Ä—Å–∏–Ω—É—Å–∞

### –†–∞—Å—á–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –Ω–∞ —Å—Ñ–µ—Ä–µ

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `lat1, lon1` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏ (–≥—Ä–∞–¥—É—Å—ã)
- `lat2, lon2` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Ç–æ—Ä–æ–π —Ç–æ—á–∫–∏ (–≥—Ä–∞–¥—É—Å—ã)

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `distance` - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–º–µ—Ç—Ä—ã)

**–§–æ—Ä–º—É–ª–∞:**
```
a = sin¬≤(ŒîœÜ/2) + cos(œÜ1) √ó cos(œÜ2) √ó sin¬≤(ŒîŒª/2)
c = 2 √ó atan2(‚àöa, ‚àö(1‚àía))
d = R √ó c

–≥–¥–µ:
œÜ - —à–∏—Ä–æ—Ç–∞ (latitude)
Œª - –¥–æ–ª–≥–æ—Ç–∞ (longitude)
R - —Ä–∞–¥–∏—É—Å –ó–µ–º–ª–∏ (6,371,000 –º)
```

**–ö–æ–¥:**
```python
def haversine_m(lat1, lon1, lat2, lon2):
    R = 6371000.0  # –†–∞–¥–∏—É—Å –ó–µ–º–ª–∏ –≤ –º–µ—Ç—Ä–∞—Ö
    
    phi1 = math.radians(lat1)
    phi2 = math.radians(lat2)
    dphi = math.radians(lat2 - lat1)
    dlambda = math.radians(lon2 - lon1)
    
    a = math.sin(dphi/2)**2 + \
        math.cos(phi1) * math.cos(phi2) * math.sin(dlambda/2)**2
    c = 2 * math.asin(math.sqrt(a))
    
    return R * c
```

**–ü—Ä–∏–º–µ—Ä:**
```
–ú–æ—Å–∫–≤–∞: 55.7558¬∞N, 37.6173¬∞E
–í–ª–∞–¥–∏–º–∏—Ä: 56.1366¬∞N, 40.4093¬∞E

œÜ1 = 55.7558¬∞ = 0.9733 —Ä–∞–¥
œÜ2 = 56.1366¬∞ = 0.9800 —Ä–∞–¥
ŒîœÜ = 0.3808¬∞ = 0.0066 —Ä–∞–¥
ŒîŒª = 2.7920¬∞ = 0.0487 —Ä–∞–¥

a = sin¬≤(0.0033) + cos(0.9733) √ó cos(0.9800) √ó sin¬≤(0.0244)
a = 0.000011 + 0.556 √ó 0.554 √ó 0.000595
a = 0.000011 + 0.000183 = 0.000194

c = 2 √ó atan2(‚àö0.000194, ‚àö0.999806)
c = 2 √ó atan2(0.0139, 0.9999)
c = 2 √ó 0.0139 = 0.0279 —Ä–∞–¥

d = 6,371,000 √ó 0.0279 = 177,750 –º ‚âà 178 –∫–º
```

**–¢–æ—á–Ω–æ—Å—Ç—å:**
- –ü–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å < 0.5% –¥–ª—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –¥–æ 1000 –∫–º
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫—Ä–∏–≤–∏–∑–Ω—É –ó–µ–º–ª–∏
- –¢–æ—á–Ω–µ–µ —á–µ–º –µ–≤–∫–ª–∏–¥–æ–≤–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ

---

## –°–ª–æ–∂–Ω–æ—Å—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤

| –ê–ª–≥–æ—Ä–∏—Ç–º | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|----------|-----------|------------|
| –†–∞—Å—á–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ | O(1) | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è |
| –†–∞—Å—á–µ—Ç —Ä–∞—Å—Ö–æ–¥–∞ | O(1) | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è |
| –†–∞—Å—á–µ—Ç –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ | O(n) | –õ–∏–Ω–µ–π–Ω—ã–π –ø—Ä–æ—Ö–æ–¥ |
| Sampling DEM | O(n) | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç rasterio |
| Densify | O(n√óm) | n=100k, m=3k —Ç–æ—á–µ–∫ |
| Haversine | O(1) | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ –≤—Ä–µ–º—è |

**–û–±—â–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∞—Ä—à—Ä—É—Ç–∞:** O(n√óm) –≥–¥–µ n=100,000, m=3,000

---

**–í—Å–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã!** üßÆ
